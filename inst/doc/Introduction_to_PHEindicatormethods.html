<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Georgina Anderson" />


<title>Introduction to PHEindicatormethods</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to PHEindicatormethods</h1>
<h4 class="author">Georgina Anderson</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This vignette introduces the following functions from the
PHEindicatormethods package and provides basic sample code to
demonstrate their execution. The code included is based on the code
provided within the ‘examples’ section of the function documentation.
This vignette does not explain the methods applied in detail but these
can (optionally) be output alongside the statistics or for a more
detailed explanation, please see the references section of the function
documentation.</p>
<div id="the-following-packages-must-be-installed-and-loaded-if-not-already-available" class="section level4">
<h4>The following packages must be installed and loaded if not already
available</h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(PHEindicatormethods)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
</div>
</div>
<div id="package-functions" class="section level2">
<h2>Package functions</h2>
<p>This vignette covers the following core functions available within
PHEindicatormethods:</p>
<table>
<colgroup>
<col width="20%" />
<col width="29%" />
<col width="49%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">phe_proportion</td>
<td align="left">Non-aggregate</td>
<td align="left">Performs a calculation on each row of data (unless data
is grouped)</td>
</tr>
<tr class="even">
<td align="left">phe_rate</td>
<td align="left">Non-aggregate</td>
<td align="left">Performs a calculation on each row of data (unless data
is grouped)</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">phe_mean</td>
<td align="left">Aggregate</td>
<td align="left">Performs a calculation on each grouping set</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">calculate_dsr</td>
<td align="left">Aggregate, standardised</td>
<td align="left">Performs a calculation on each grouping set and
requires additional reference inputs</td>
</tr>
<tr class="odd">
<td align="left">calculate_ISRatio</td>
<td align="left">Aggregate, standardised</td>
<td align="left">Performs a calculation on each grouping set and
requires additional reference inputs</td>
</tr>
<tr class="even">
<td align="left">calculate_ISRate</td>
<td align="left">Aggregate, standardised</td>
<td align="left">Performs a calculation on each grouping set and
requires additional reference inputs</td>
</tr>
</tbody>
</table>
<p>Other functions are introduced in separate vignettes.</p>
</div>
<div id="non-aggregate-functions" class="section level2">
<h2>Non-aggregate functions</h2>
<div id="create-some-test-data-for-the-non-aggregate-functions" class="section level4">
<h4>Create some test data for the non-aggregate functions</h4>
<p>The following code chunk creates a data frame containing observed
number of events and populations for 4 geographical areas over 2 time
periods that is used later to demonstrate the PHEindicatormethods
package functions:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>        <span class="at">area =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Area1&quot;</span>,<span class="st">&quot;Area2&quot;</span>,<span class="st">&quot;Area3&quot;</span>,<span class="st">&quot;Area4&quot;</span>), <span class="dv">2</span>),</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>        <span class="at">year =</span> <span class="fu">rep</span>(<span class="dv">2015</span><span class="sc">:</span><span class="dv">2016</span>, <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>        <span class="at">obs =</span> <span class="fu">sample</span>(<span class="dv">100</span>, <span class="dv">2</span> <span class="sc">*</span> <span class="dv">4</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>        <span class="at">pop =</span> <span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">200</span>, <span class="dv">2</span> <span class="sc">*</span> <span class="dv">4</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>df</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt;    area year obs pop</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; 1 Area1 2015  27 156</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt; 2 Area2 2015  36 145</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt; 3 Area3 2015  29 120</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; 4 Area4 2015  79 123</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt; 5 Area1 2016  53 101</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt; 6 Area2 2016  46 188</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; 7 Area3 2016  91 156</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; 8 Area4 2016  43 190</span></span></code></pre></div>
</div>
<div id="execute-phe_proportion-and-phe_rate" class="section level4">
<h4>Execute phe_proportion and phe_rate</h4>
<p><strong>INPUT:</strong> The phe_proportion and phe_rate functions
take a single data frame as input with columns representing the
numerators and denominators for the statistic. Any other columns present
will be retained in the output.</p>
<p><strong>OUTPUT:</strong> The functions output the original data frame
with additional columns appended. By default the additional columns are
the proportion or rate, the lower 95% confidence limit, the upper 95%
confidence limit, the confidence level, the statistic name and the
method.</p>
<p><strong>OPTIONS:</strong> The functions also accept additional
arguments to specify the level of confidence, the multiplier and a
reduced level of detail to be output.</p>
<p>Here are some example code chunks to demonstrate these two functions
and the arguments that can optionally be specified</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># default proportion</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">phe_proportion</span>(df, obs, pop)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt;    area year obs pop     value   lowercl   uppercl confidence       statistic</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; 1 Area1 2015  27 156 0.1730769 0.1217616 0.2401061        95% proportion of 1</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; 2 Area2 2015  36 145 0.2482759 0.1850655 0.3244797        95% proportion of 1</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; 3 Area3 2015  29 120 0.2416667 0.1738584 0.3255015        95% proportion of 1</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; 4 Area4 2015  79 123 0.6422764 0.5544397 0.7214953        95% proportion of 1</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; 5 Area1 2016  53 101 0.5247525 0.4282498 0.6194412        95% proportion of 1</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; 6 Area2 2016  46 188 0.2446809 0.1887455 0.3108413        95% proportion of 1</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; 7 Area3 2016  91 156 0.5833333 0.5048757 0.6577855        95% proportion of 1</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; 8 Area4 2016  43 190 0.2263158 0.1725838 0.2908953        95% proportion of 1</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt;   method</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; 1 Wilson</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; 2 Wilson</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; 3 Wilson</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt; 4 Wilson</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt; 5 Wilson</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt; 6 Wilson</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">#&gt; 7 Wilson</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co">#&gt; 8 Wilson</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co"># specify confidence level for proportion</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="fu">phe_proportion</span>(df, obs, pop, <span class="at">confidence =</span> <span class="fl">99.8</span>)</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="co">#&gt;    area year obs pop     value    lowercl   uppercl confidence       statistic</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="co">#&gt; 1 Area1 2015  27 156 0.1730769 0.09913737 0.2847328      99.8% proportion of 1</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="co">#&gt; 2 Area2 2015  36 145 0.2482759 0.15532170 0.3723378      99.8% proportion of 1</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co">#&gt; 3 Area3 2015  29 120 0.2416667 0.14293143 0.3784872      99.8% proportion of 1</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="co">#&gt; 4 Area4 2015  79 123 0.6422764 0.50296043 0.7610918      99.8% proportion of 1</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="co">#&gt; 5 Area1 2016  53 101 0.5247525 0.37582448 0.6694041      99.8% proportion of 1</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="co">#&gt; 6 Area2 2016  46 188 0.2446809 0.16170173 0.3523442      99.8% proportion of 1</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co">#&gt; 7 Area3 2016  91 156 0.5833333 0.46002112 0.6970316      99.8% proportion of 1</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="co">#&gt; 8 Area4 2016  43 190 0.2263158 0.14694208 0.3318841      99.8% proportion of 1</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="co">#&gt;   method</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a><span class="co">#&gt; 1 Wilson</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a><span class="co">#&gt; 2 Wilson</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="co">#&gt; 3 Wilson</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="co">#&gt; 4 Wilson</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="co">#&gt; 5 Wilson</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="co">#&gt; 6 Wilson</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="co">#&gt; 7 Wilson</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="co">#&gt; 8 Wilson</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="co"># specify multiplier to output proportions as percentages</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="fu">phe_proportion</span>(df, obs, pop, <span class="at">multiplier =</span> <span class="dv">100</span>)</span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a><span class="co">#&gt;    area year obs pop    value  lowercl  uppercl confidence  statistic method</span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a><span class="co">#&gt; 1 Area1 2015  27 156 17.30769 12.17616 24.01061        95% percentage Wilson</span></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a><span class="co">#&gt; 2 Area2 2015  36 145 24.82759 18.50655 32.44797        95% percentage Wilson</span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a><span class="co">#&gt; 3 Area3 2015  29 120 24.16667 17.38584 32.55015        95% percentage Wilson</span></span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a><span class="co">#&gt; 4 Area4 2015  79 123 64.22764 55.44397 72.14953        95% percentage Wilson</span></span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a><span class="co">#&gt; 5 Area1 2016  53 101 52.47525 42.82498 61.94412        95% percentage Wilson</span></span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a><span class="co">#&gt; 6 Area2 2016  46 188 24.46809 18.87455 31.08413        95% percentage Wilson</span></span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a><span class="co">#&gt; 7 Area3 2016  91 156 58.33333 50.48757 65.77855        95% percentage Wilson</span></span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a><span class="co">#&gt; 8 Area4 2016  43 190 22.63158 17.25838 29.08953        95% percentage Wilson</span></span>
<span id="cb3-54"><a href="#cb3-54" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" tabindex="-1"></a><span class="co"># specify multiplier for proportion, confidence level and remove metadata columns</span></span>
<span id="cb3-56"><a href="#cb3-56" tabindex="-1"></a><span class="fu">phe_proportion</span>(df, obs, pop, <span class="at">confidence =</span> <span class="fl">99.8</span>, <span class="at">multiplier =</span> <span class="dv">100</span>, <span class="at">type =</span> <span class="st">&quot;standard&quot;</span>)</span>
<span id="cb3-57"><a href="#cb3-57" tabindex="-1"></a><span class="co">#&gt;    area year obs pop    value   lowercl  uppercl</span></span>
<span id="cb3-58"><a href="#cb3-58" tabindex="-1"></a><span class="co">#&gt; 1 Area1 2015  27 156 17.30769  9.913737 28.47328</span></span>
<span id="cb3-59"><a href="#cb3-59" tabindex="-1"></a><span class="co">#&gt; 2 Area2 2015  36 145 24.82759 15.532170 37.23378</span></span>
<span id="cb3-60"><a href="#cb3-60" tabindex="-1"></a><span class="co">#&gt; 3 Area3 2015  29 120 24.16667 14.293143 37.84872</span></span>
<span id="cb3-61"><a href="#cb3-61" tabindex="-1"></a><span class="co">#&gt; 4 Area4 2015  79 123 64.22764 50.296043 76.10918</span></span>
<span id="cb3-62"><a href="#cb3-62" tabindex="-1"></a><span class="co">#&gt; 5 Area1 2016  53 101 52.47525 37.582448 66.94041</span></span>
<span id="cb3-63"><a href="#cb3-63" tabindex="-1"></a><span class="co">#&gt; 6 Area2 2016  46 188 24.46809 16.170173 35.23442</span></span>
<span id="cb3-64"><a href="#cb3-64" tabindex="-1"></a><span class="co">#&gt; 7 Area3 2016  91 156 58.33333 46.002112 69.70316</span></span>
<span id="cb3-65"><a href="#cb3-65" tabindex="-1"></a><span class="co">#&gt; 8 Area4 2016  43 190 22.63158 14.694208 33.18841</span></span>
<span id="cb3-66"><a href="#cb3-66" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" tabindex="-1"></a><span class="co"># default rate</span></span>
<span id="cb3-68"><a href="#cb3-68" tabindex="-1"></a><span class="fu">phe_rate</span>(df, obs, pop)</span>
<span id="cb3-69"><a href="#cb3-69" tabindex="-1"></a><span class="co">#&gt;    area year obs pop    value  lowercl  uppercl confidence       statistic</span></span>
<span id="cb3-70"><a href="#cb3-70" tabindex="-1"></a><span class="co">#&gt; 1 Area1 2015  27 156 17307.69 11403.18 25182.76        95% rate per 100000</span></span>
<span id="cb3-71"><a href="#cb3-71" tabindex="-1"></a><span class="co">#&gt; 2 Area2 2015  36 145 24827.59 17386.52 34372.86        95% rate per 100000</span></span>
<span id="cb3-72"><a href="#cb3-72" tabindex="-1"></a><span class="co">#&gt; 3 Area3 2015  29 120 24166.67 16181.45 34708.62        95% rate per 100000</span></span>
<span id="cb3-73"><a href="#cb3-73" tabindex="-1"></a><span class="co">#&gt; 4 Area4 2015  79 123 64227.64 50847.87 80047.81        95% rate per 100000</span></span>
<span id="cb3-74"><a href="#cb3-74" tabindex="-1"></a><span class="co">#&gt; 5 Area1 2016  53 101 52475.25 39304.83 68640.27        95% rate per 100000</span></span>
<span id="cb3-75"><a href="#cb3-75" tabindex="-1"></a><span class="co">#&gt; 6 Area2 2016  46 188 24468.09 17912.11 32637.75        95% rate per 100000</span></span>
<span id="cb3-76"><a href="#cb3-76" tabindex="-1"></a><span class="co">#&gt; 7 Area3 2016  91 156 58333.33 46965.08 71621.16        95% rate per 100000</span></span>
<span id="cb3-77"><a href="#cb3-77" tabindex="-1"></a><span class="co">#&gt; 8 Area4 2016  43 190 22631.58 16376.93 30485.34        95% rate per 100000</span></span>
<span id="cb3-78"><a href="#cb3-78" tabindex="-1"></a><span class="co">#&gt;   method</span></span>
<span id="cb3-79"><a href="#cb3-79" tabindex="-1"></a><span class="co">#&gt; 1  Byars</span></span>
<span id="cb3-80"><a href="#cb3-80" tabindex="-1"></a><span class="co">#&gt; 2  Byars</span></span>
<span id="cb3-81"><a href="#cb3-81" tabindex="-1"></a><span class="co">#&gt; 3  Byars</span></span>
<span id="cb3-82"><a href="#cb3-82" tabindex="-1"></a><span class="co">#&gt; 4  Byars</span></span>
<span id="cb3-83"><a href="#cb3-83" tabindex="-1"></a><span class="co">#&gt; 5  Byars</span></span>
<span id="cb3-84"><a href="#cb3-84" tabindex="-1"></a><span class="co">#&gt; 6  Byars</span></span>
<span id="cb3-85"><a href="#cb3-85" tabindex="-1"></a><span class="co">#&gt; 7  Byars</span></span>
<span id="cb3-86"><a href="#cb3-86" tabindex="-1"></a><span class="co">#&gt; 8  Byars</span></span>
<span id="cb3-87"><a href="#cb3-87" tabindex="-1"></a></span>
<span id="cb3-88"><a href="#cb3-88" tabindex="-1"></a><span class="co"># specify multiplier for rate and confidence level</span></span>
<span id="cb3-89"><a href="#cb3-89" tabindex="-1"></a><span class="fu">phe_rate</span>(df, obs, pop, <span class="at">confidence =</span> <span class="fl">99.8</span>, <span class="at">multiplier =</span> <span class="dv">100</span>)</span>
<span id="cb3-90"><a href="#cb3-90" tabindex="-1"></a><span class="co">#&gt;    area year obs pop    value   lowercl  uppercl confidence    statistic method</span></span>
<span id="cb3-91"><a href="#cb3-91" tabindex="-1"></a><span class="co">#&gt; 1 Area1 2015  27 156 17.30769  8.783552 30.29970      99.8% rate per 100  Byars</span></span>
<span id="cb3-92"><a href="#cb3-92" tabindex="-1"></a><span class="co">#&gt; 2 Area2 2015  36 145 24.82759 13.952944 40.48648      99.8% rate per 100  Byars</span></span>
<span id="cb3-93"><a href="#cb3-93" tabindex="-1"></a><span class="co">#&gt; 3 Area3 2015  29 120 24.16667 12.601525 41.53299      99.8% rate per 100  Byars</span></span>
<span id="cb3-94"><a href="#cb3-94" tabindex="-1"></a><span class="co">#&gt; 4 Area4 2015  79 123 64.22764 44.173569 89.86280      99.8% rate per 100  Byars</span></span>
<span id="cb3-95"><a href="#cb3-95" tabindex="-1"></a><span class="co">#&gt; 5 Area1 2016  53 101 52.47525 32.961126 78.81964      99.8% rate per 100  Byars</span></span>
<span id="cb3-96"><a href="#cb3-96" tabindex="-1"></a><span class="co">#&gt; 6 Area2 2016  46 188 24.46809 14.799981 37.81279      99.8% rate per 100  Byars</span></span>
<span id="cb3-97"><a href="#cb3-97" tabindex="-1"></a><span class="co">#&gt; 7 Area3 2016  91 156 58.33333 41.233844 79.82645      99.8% rate per 100  Byars</span></span>
<span id="cb3-98"><a href="#cb3-98" tabindex="-1"></a><span class="co">#&gt; 8 Area4 2016  43 190 22.63158 13.429676 35.47490      99.8% rate per 100  Byars</span></span>
<span id="cb3-99"><a href="#cb3-99" tabindex="-1"></a></span>
<span id="cb3-100"><a href="#cb3-100" tabindex="-1"></a><span class="co"># specify multiplier for rate, confidence level and remove metadata columns</span></span>
<span id="cb3-101"><a href="#cb3-101" tabindex="-1"></a><span class="fu">phe_rate</span>(df, obs, pop, <span class="at">type =</span> <span class="st">&quot;standard&quot;</span>, <span class="at">confidence =</span> <span class="fl">99.8</span>, <span class="at">multiplier =</span> <span class="dv">100</span>)</span>
<span id="cb3-102"><a href="#cb3-102" tabindex="-1"></a><span class="co">#&gt;    area year obs pop    value   lowercl  uppercl</span></span>
<span id="cb3-103"><a href="#cb3-103" tabindex="-1"></a><span class="co">#&gt; 1 Area1 2015  27 156 17.30769  8.783552 30.29970</span></span>
<span id="cb3-104"><a href="#cb3-104" tabindex="-1"></a><span class="co">#&gt; 2 Area2 2015  36 145 24.82759 13.952944 40.48648</span></span>
<span id="cb3-105"><a href="#cb3-105" tabindex="-1"></a><span class="co">#&gt; 3 Area3 2015  29 120 24.16667 12.601525 41.53299</span></span>
<span id="cb3-106"><a href="#cb3-106" tabindex="-1"></a><span class="co">#&gt; 4 Area4 2015  79 123 64.22764 44.173569 89.86280</span></span>
<span id="cb3-107"><a href="#cb3-107" tabindex="-1"></a><span class="co">#&gt; 5 Area1 2016  53 101 52.47525 32.961126 78.81964</span></span>
<span id="cb3-108"><a href="#cb3-108" tabindex="-1"></a><span class="co">#&gt; 6 Area2 2016  46 188 24.46809 14.799981 37.81279</span></span>
<span id="cb3-109"><a href="#cb3-109" tabindex="-1"></a><span class="co">#&gt; 7 Area3 2016  91 156 58.33333 41.233844 79.82645</span></span>
<span id="cb3-110"><a href="#cb3-110" tabindex="-1"></a><span class="co">#&gt; 8 Area4 2016  43 190 22.63158 13.429676 35.47490</span></span></code></pre></div>
<p>These functions can also return aggregate data if the input
dataframes are grouped:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># default proportion - grouped</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="fu">phe_proportion</span>(obs, pop)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 9</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; # Groups:   year [2]</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt;    year   obs   pop value lowercl uppercl confidence statistic       method</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;chr&gt; </span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; 1  2015   171   544 0.314   0.277   0.355 95%        proportion of 1 Wilson</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; 2  2016   233   635 0.367   0.330   0.405 95%        proportion of 1 Wilson</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co"># default rate - grouped</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>  <span class="fu">phe_rate</span>(obs, pop)</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 9</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt; # Groups:   year [2]</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt;    year   obs   pop  value lowercl uppercl confidence statistic       method</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;chr&gt; </span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt; 1  2015   171   544 31434.  26899.  36515. 95%        rate per 100000 Byars </span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt; 2  2016   233   635 36693.  32132.  41719. 95%        rate per 100000 Byars</span></span></code></pre></div>
<p><br /> <br /></p>
</div>
</div>
<div id="aggregate-functions" class="section level2">
<h2>Aggregate functions</h2>
<p>The remaining functions aggregate the rows in the input data frame to
produce a single statistic. It is also possible to calculate multiple
statistics in a single execution of these functions if the input data
frame is grouped - for example by indicator ID, geographic area or time
period (or all three). The output contains only the grouping variables
and the values calculated by the function - any additional unused
columns provided in the input data frame will not be retained in the
output.</p>
<p>The df test data generated earlier can be used to demonstrate
phe_mean:</p>
<div id="execute-phe_mean" class="section level4">
<h4>Execute phe_mean</h4>
<p><strong>INPUT:</strong> The phe_mean function take a single data
frame as input with a column representing the numbers to be
averaged.</p>
<p><strong>OUTPUT:</strong> By default, the function outputs one row per
grouping set containing the grouping variable values (if applicable),
the mean, the lower 95% confidence limit, the upper 95% confidence
limit, the confidence level, the statistic name and the method.</p>
<p><strong>OPTIONS:</strong> The function also accepts additional
arguments to specify the level of confidence and a reduced level of
detail to be output.</p>
<p>Here are some example code chunks to demonstrate the phe_mean
function and the arguments that can optionally be specified</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># default mean</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">phe_mean</span>(df,obs)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt;   value_sum value_count    stdev value  lowercl  uppercl confidence statistic</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; 1       404           8 23.17634  50.5 31.12409 69.87591        95%      mean</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt;                     method</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; 1 Student&#39;s t-distribution</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co"># multiple means in a single execution with 99.8% confidence</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>    <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>        <span class="fu">phe_mean</span>(obs, <span class="at">confidence =</span> <span class="fl">0.998</span>)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 10</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; # Groups:   year [2]</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt;    year value_sum value_count stdev value lowercl uppercl confidence statistic</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;     &lt;int&gt;       &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;    </span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; 1  2015       171           4  24.5  42.8   -82.2    168. 99.8%      mean     </span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; 2  2016       233           4  22.2  58.2   -55.3    172. 99.8%      mean     </span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; # ℹ 1 more variable: method &lt;chr&gt;</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co"># multiple means in a single execution with 99.8% confidence and data-only output</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>    <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>        <span class="fu">phe_mean</span>(obs, <span class="at">type =</span> <span class="st">&quot;standard&quot;</span>, <span class="at">confidence =</span> <span class="fl">0.998</span>)</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 7</span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="co">#&gt; # Groups:   year [2]</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="co">#&gt;    year value_sum value_count stdev value lowercl uppercl</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;     &lt;int&gt;       &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a><span class="co">#&gt; 1  2015       171           4  24.5  42.8   -82.2    168.</span></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="co">#&gt; 2  2016       233           4  22.2  58.2   -55.3    172.</span></span></code></pre></div>
</div>
</div>
<div id="standardised-aggregate-functions" class="section level2">
<h2>Standardised Aggregate functions</h2>
<div id="create-some-test-data-for-the-standardised-aggregate-functions" class="section level4">
<h4>Create some test data for the standardised aggregate functions</h4>
<p>The following code chunk creates a data frame containing observed
number of events and populations by age band for 4 areas, 5 time periods
and 2 sexes:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>df_std <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>            <span class="at">area =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Area1&quot;</span>, <span class="st">&quot;Area2&quot;</span>, <span class="st">&quot;Area3&quot;</span>, <span class="st">&quot;Area4&quot;</span>), <span class="at">each =</span> <span class="dv">19</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">5</span>),</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>            <span class="at">year =</span> <span class="fu">rep</span>(<span class="dv">2006</span><span class="sc">:</span><span class="dv">2010</span>, <span class="at">each =</span> <span class="dv">19</span> <span class="sc">*</span> <span class="dv">2</span>),</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>            <span class="at">sex =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>), <span class="at">each =</span> <span class="dv">19</span>), <span class="dv">5</span>),</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>            <span class="at">ageband =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>,<span class="dv">25</span>,<span class="dv">30</span>,<span class="dv">35</span>,<span class="dv">40</span>,<span class="dv">45</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>                           <span class="dv">50</span>,<span class="dv">55</span>,<span class="dv">60</span>,<span class="dv">65</span>,<span class="dv">70</span>,<span class="dv">75</span>,<span class="dv">80</span>,<span class="dv">85</span>,<span class="dv">90</span>), <span class="at">times =</span> <span class="dv">10</span>),</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>            <span class="at">obs =</span> <span class="fu">sample</span>(<span class="dv">200</span>, <span class="dv">19</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">5</span> <span class="sc">*</span> <span class="dv">4</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>            <span class="at">pop =</span> <span class="fu">sample</span>(<span class="dv">10000</span><span class="sc">:</span><span class="dv">20000</span>, <span class="dv">19</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">5</span> <span class="sc">*</span> <span class="dv">4</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="fu">head</span>(df_std)</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt;    area year  sex ageband obs   pop</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; 1 Area1 2006 Male       0 195 15786</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; 2 Area1 2006 Male       5 159 18310</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; 3 Area1 2006 Male      10 129 14997</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; 4 Area1 2006 Male      15 121 18247</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; 5 Area1 2006 Male      20  77 10446</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; 6 Area1 2006 Male      25  46 15595</span></span></code></pre></div>
</div>
<div id="execute-calculate_dsr" class="section level4">
<h4>Execute calculate_dsr</h4>
<p><strong>INPUT:</strong> The minimum input requirement for the
calculate_dsr function is a single data frame with columns representing
the numerators and denominators and standard populations for each
standardisation category. The standard populations must be appended to
the input data frame by the user prior to execution of the function. The
2013 European Standard Population is provided within the package in
vector form (<code>esp2013</code>), which you can join to your dataset.
Alternative standard populations can be used but must be provided by the
user.</p>
<p><strong>OUTPUT:</strong> By default, the function outputs one row per
grouping set containing the grouping variable values, the total count,
the total population, the dsr, the lower 95% confidence limit, the upper
95% confidence limit, the confidence level, the statistic name and the
method.</p>
<p><strong>OPTIONS:</strong> The function also accepts additional
arguments to specify the level of confidence, the multiplier and a
reduced level of detail to be output. It is also possible to calculate
CIs when we can’t assume events are independent - further details can be
found in the DSR vignette.</p>
<p>Here are some example code chunks to demonstrate the calculate_dsr
function and the arguments that can optionally be specified</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co"># Append the standard populations to the data frame</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co"># calculate separate dsrs for each area, year and sex</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>df_std <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">refpop =</span> <span class="fu">rep</span>(esp2013, <span class="dv">40</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="fu">group_by</span>(area, year, sex) <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    <span class="fu">calculate_dsr</span>(obs,pop, <span class="at">stdpop =</span> refpop)</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; # A tibble: 40 × 11</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt;    area   year sex    total_count total_pop value lowercl uppercl confidence</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;int&gt; &lt;chr&gt;        &lt;int&gt;     &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     </span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt;  1 Area1  2006 Female        1976    285485  712.    679.    746. 95%       </span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt;  2 Area1  2006 Male          2067    292506  713.    680.    748. 95%       </span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt;  3 Area1  2007 Female        2027    304681  670.    638.    702. 95%       </span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt;  4 Area1  2007 Male          2110    292002  761.    726.    796. 95%       </span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt;  5 Area1  2008 Female        1872    288328  706.    673.    740. 95%       </span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt;  6 Area1  2008 Male          2172    284452  807.    771.    844. 95%       </span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt;  7 Area1  2009 Female        1765    272181  651.    619.    684. 95%       </span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt;  8 Area1  2009 Male          1935    280477  760.    725.    797. 95%       </span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt;  9 Area1  2010 Female        2419    293242  924.    884.    965. 95%       </span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt; 10 Area1  2010 Male          2137    266901  878.    839.    918. 95%       </span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt; # ℹ 30 more rows</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: statistic &lt;chr&gt;, method &lt;chr&gt;</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="co"># Append the standard populations to the data frame</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="co"># calculate separate dsrs for each area, year and sex and drop metadata fields from output</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>df_std <span class="sc">%&gt;%</span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">refpop =</span> <span class="fu">rep</span>(esp2013, <span class="dv">40</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>    <span class="fu">group_by</span>(area, year, sex) <span class="sc">%&gt;%</span></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>    <span class="fu">calculate_dsr</span>(obs,pop, <span class="at">stdpop =</span> refpop, <span class="at">type =</span> <span class="st">&quot;standard&quot;</span>)</span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a><span class="co">#&gt; # A tibble: 40 × 8</span></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a><span class="co">#&gt;    area   year sex    total_count total_pop value lowercl uppercl</span></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;int&gt; &lt;chr&gt;        &lt;int&gt;     &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a><span class="co">#&gt;  1 Area1  2006 Female        1976    285485  712.    679.    746.</span></span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a><span class="co">#&gt;  2 Area1  2006 Male          2067    292506  713.    680.    748.</span></span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a><span class="co">#&gt;  3 Area1  2007 Female        2027    304681  670.    638.    702.</span></span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a><span class="co">#&gt;  4 Area1  2007 Male          2110    292002  761.    726.    796.</span></span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a><span class="co">#&gt;  5 Area1  2008 Female        1872    288328  706.    673.    740.</span></span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a><span class="co">#&gt;  6 Area1  2008 Male          2172    284452  807.    771.    844.</span></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a><span class="co">#&gt;  7 Area1  2009 Female        1765    272181  651.    619.    684.</span></span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a><span class="co">#&gt;  8 Area1  2009 Male          1935    280477  760.    725.    797.</span></span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a><span class="co">#&gt;  9 Area1  2010 Female        2419    293242  924.    884.    965.</span></span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a><span class="co">#&gt; 10 Area1  2010 Male          2137    266901  878.    839.    918.</span></span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a><span class="co">#&gt; # ℹ 30 more rows</span></span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a><span class="co"># calculate for under 75s by filtering out records for 75+ from input data frame and standard population</span></span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a>df_std <span class="sc">%&gt;%</span></span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a>  <span class="fu">filter</span>(ageband <span class="sc">&lt;=</span> <span class="dv">70</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">refpop =</span> <span class="fu">rep</span>(esp2013[<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>], <span class="dv">40</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a>  <span class="fu">group_by</span>(area, year, sex) <span class="sc">%&gt;%</span></span>
<span id="cb7-51"><a href="#cb7-51" tabindex="-1"></a>  <span class="fu">calculate_dsr</span>(obs, pop, <span class="at">stdpop =</span> refpop)</span>
<span id="cb7-52"><a href="#cb7-52" tabindex="-1"></a><span class="co">#&gt; # A tibble: 40 × 11</span></span>
<span id="cb7-53"><a href="#cb7-53" tabindex="-1"></a><span class="co">#&gt;    area   year sex    total_count total_pop value lowercl uppercl confidence</span></span>
<span id="cb7-54"><a href="#cb7-54" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;int&gt; &lt;chr&gt;        &lt;int&gt;     &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     </span></span>
<span id="cb7-55"><a href="#cb7-55" tabindex="-1"></a><span class="co">#&gt;  1 Area1  2006 Female        1613    227232  716.    681.    752. 95%       </span></span>
<span id="cb7-56"><a href="#cb7-56" tabindex="-1"></a><span class="co">#&gt;  2 Area1  2006 Male          1541    222402  722.    685.    760. 95%       </span></span>
<span id="cb7-57"><a href="#cb7-57" tabindex="-1"></a><span class="co">#&gt;  3 Area1  2007 Female        1484    235090  667.    632.    702. 95%       </span></span>
<span id="cb7-58"><a href="#cb7-58" tabindex="-1"></a><span class="co">#&gt;  4 Area1  2007 Male          1688    226660  772.    735.    811. 95%       </span></span>
<span id="cb7-59"><a href="#cb7-59" tabindex="-1"></a><span class="co">#&gt;  5 Area1  2008 Female        1594    231582  714.    679.    751. 95%       </span></span>
<span id="cb7-60"><a href="#cb7-60" tabindex="-1"></a><span class="co">#&gt;  6 Area1  2008 Male          1797    227822  825.    786.    865. 95%       </span></span>
<span id="cb7-61"><a href="#cb7-61" tabindex="-1"></a><span class="co">#&gt;  7 Area1  2009 Female        1361    223702  635.    601.    670. 95%       </span></span>
<span id="cb7-62"><a href="#cb7-62" tabindex="-1"></a><span class="co">#&gt;  8 Area1  2009 Male          1722    216161  806.    767.    846. 95%       </span></span>
<span id="cb7-63"><a href="#cb7-63" tabindex="-1"></a><span class="co">#&gt;  9 Area1  2010 Female        2020    215807  978.    935.   1023. 95%       </span></span>
<span id="cb7-64"><a href="#cb7-64" tabindex="-1"></a><span class="co">#&gt; 10 Area1  2010 Male          1748    201405  891.    849.    934. 95%       </span></span>
<span id="cb7-65"><a href="#cb7-65" tabindex="-1"></a><span class="co">#&gt; # ℹ 30 more rows</span></span>
<span id="cb7-66"><a href="#cb7-66" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: statistic &lt;chr&gt;, method &lt;chr&gt;</span></span></code></pre></div>
</div>
<div id="execute-calculate_isratio-and-calculate_israte" class="section level4">
<h4>Execute calculate_ISRatio and calculate_ISRate</h4>
<p><strong>INPUT:</strong> These functions take a single data frame as
input, with columns representing the numerators and denominators for
each standardisation category, plus reference numerators and
denominators for each standardisation category.</p>
<p>The reference data can either be provided in a separate data
frame/vectors or as columns within the input data frame:</p>
<ul>
<li><p>reference data provided as a data frame or as vectors - the data
frame/vectors and the input data frame must both contain rows for the
same standardisation categories, and both must be sorted, within each
grouping set, by these standardisation categories in the same
order.</p></li>
<li><p>reference data provided as columns within the input data frame -
the reference numerators and denominators can be appended to the input
data frame prior to execution of the function - if the data is grouped
to generate multiple indirectly standardised rates or ratios then the
reference data will need to be repeated and appended to the data rows
for every grouping set.</p></li>
</ul>
<p><strong>OUTPUT:</strong> By default, the functions output one row per
grouping set containing the grouping variable values, the observed and
expected counts, the reference rate (ISRate only), the indirectly
standardised rate or ratio, the lower 95% confidence limit, and the
upper 95% confidence limit, the confidence level, the statistic name and
the method.</p>
<p><strong>OPTIONS:</strong> If reference data are being provided as
columns within the input data frame then the user must specify this as
the function expects vectors by default. The function also accepts
additional arguments to specify the level of confidence, the multiplier
and a reduced level of detail to be output.</p>
<p>The following code chunk creates a data frame containing the
reference data - this example uses the all area data for persons in the
baseline year:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>df_ref <span class="ot">&lt;-</span> df_std <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2006</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    <span class="fu">group_by</span>(ageband) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">obs =</span> <span class="fu">sum</span>(obs),</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>              <span class="at">pop =</span> <span class="fu">sum</span>(pop),</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">&quot;drop_last&quot;</span>)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    </span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="fu">head</span>(df_ref)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt;   ageband   obs    pop</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt;     &lt;dbl&gt; &lt;int&gt;  &lt;int&gt;</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; 1       0   970 113564</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; 2       5   971 103121</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; 3      10   831 112802</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; 4      15   865 128519</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt; 5      20   952 111298</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt; 6      25   400 129930</span></span></code></pre></div>
<p>Here are some example code chunks to demonstrate the
calculate_ISRatio function and the arguments that can optionally be
specified</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># calculate separate smrs for each area, year and sex</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co"># standardised against the all-year, all-sex, all-area reference data</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>df_std <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    <span class="fu">group_by</span>(area, year, sex) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    <span class="fu">calculate_ISRatio</span>(obs, pop, df_ref<span class="sc">$</span>obs, df_ref<span class="sc">$</span>pop)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; # A tibble: 40 × 11</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; # Groups:   area, year, sex [40]</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt;    area   year sex    observed expected value lowercl uppercl confidence</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;int&gt; &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     </span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt;  1 Area1  2006 Female     1976    1921. 1.03    0.984    1.08 95%       </span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt;  2 Area1  2006 Male       2067    1971. 1.05    1.00     1.09 95%       </span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt;  3 Area1  2007 Female     2027    2100. 0.965   0.924    1.01 95%       </span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt;  4 Area1  2007 Male       2110    1984. 1.06    1.02     1.11 95%       </span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt;  5 Area1  2008 Female     1872    1957. 0.957   0.914    1.00 95%       </span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt;  6 Area1  2008 Male       2172    1958. 1.11    1.06     1.16 95%       </span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt;  7 Area1  2009 Female     1765    1848. 0.955   0.911    1.00 95%       </span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt;  8 Area1  2009 Male       1935    1869. 1.04    0.990    1.08 95%       </span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co">#&gt;  9 Area1  2010 Female     2419    2013. 1.20    1.15     1.25 95%       </span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#&gt; 10 Area1  2010 Male       2137    1799. 1.19    1.14     1.24 95%       </span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">#&gt; # ℹ 30 more rows</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: statistic &lt;chr&gt;, method &lt;chr&gt;</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="co"># calculate the same smrs by appending the reference data to the data frame</span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a><span class="co"># and drop metadata columns from output</span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>df_std <span class="sc">%&gt;%</span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">refobs =</span> <span class="fu">rep</span>(df_ref<span class="sc">$</span>obs,<span class="dv">40</span>),</span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>           <span class="at">refpop =</span> <span class="fu">rep</span>(df_ref<span class="sc">$</span>pop,<span class="dv">40</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a>    <span class="fu">group_by</span>(area, year, sex) <span class="sc">%&gt;%</span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a>    <span class="fu">calculate_ISRatio</span>(obs, pop, refobs, refpop, <span class="at">refpoptype =</span> <span class="st">&quot;field&quot;</span>,</span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>                      <span class="at">type =</span> <span class="st">&quot;standard&quot;</span>)</span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a><span class="co">#&gt; # A tibble: 40 × 8</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a><span class="co">#&gt; # Groups:   area, year, sex [40]</span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="co">#&gt;    area   year sex    observed expected value lowercl uppercl</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;int&gt; &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a><span class="co">#&gt;  1 Area1  2006 Female     1976    1921. 1.03    0.984    1.08</span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a><span class="co">#&gt;  2 Area1  2006 Male       2067    1971. 1.05    1.00     1.09</span></span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a><span class="co">#&gt;  3 Area1  2007 Female     2027    2100. 0.965   0.924    1.01</span></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a><span class="co">#&gt;  4 Area1  2007 Male       2110    1984. 1.06    1.02     1.11</span></span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a><span class="co">#&gt;  5 Area1  2008 Female     1872    1957. 0.957   0.914    1.00</span></span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a><span class="co">#&gt;  6 Area1  2008 Male       2172    1958. 1.11    1.06     1.16</span></span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a><span class="co">#&gt;  7 Area1  2009 Female     1765    1848. 0.955   0.911    1.00</span></span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a><span class="co">#&gt;  8 Area1  2009 Male       1935    1869. 1.04    0.990    1.08</span></span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a><span class="co">#&gt;  9 Area1  2010 Female     2419    2013. 1.20    1.15     1.25</span></span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a><span class="co">#&gt; 10 Area1  2010 Male       2137    1799. 1.19    1.14     1.24</span></span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a><span class="co">#&gt; # ℹ 30 more rows</span></span></code></pre></div>
<p>The calculate_ISRate function works exactly the same way but instead
of expressing the result as a ratio of the observed and expected rates
the result is expressed as a rate and the reference rate is also
provided. Here are some examples:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># calculate separate indirectly standardised rates for each area, year and sex</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co"># standardised against the all-year, all-sex, all-area reference data</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>df_std <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    <span class="fu">group_by</span>(area, year, sex) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>    <span class="fu">calculate_ISRate</span>(obs, pop, df_ref<span class="sc">$</span>obs, df_ref<span class="sc">$</span>pop)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; # A tibble: 40 × 12</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; # Groups:   area, year, sex [40]</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt;    area   year sex   observed expected ref_rate value lowercl uppercl confidence</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;int&gt; &lt;chr&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     </span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt;  1 Area1  2006 Fema…     1976    1921.     671.  690.    660.    721. 95%       </span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt;  2 Area1  2006 Male      2067    1971.     671.  703.    673.    734. 95%       </span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt;  3 Area1  2007 Fema…     2027    2100.     671.  647.    619.    676. 95%       </span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt;  4 Area1  2007 Male      2110    1984.     671.  713.    683.    744. 95%       </span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt;  5 Area1  2008 Fema…     1872    1957.     671.  641.    613.    671. 95%       </span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt;  6 Area1  2008 Male      2172    1958.     671.  744.    713.    776. 95%       </span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt;  7 Area1  2009 Fema…     1765    1848.     671.  640.    611.    671. 95%       </span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt;  8 Area1  2009 Male      1935    1869.     671.  694.    664.    726. 95%       </span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt;  9 Area1  2010 Fema…     2419    2013.     671.  806.    774.    839. 95%       </span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co">#&gt; 10 Area1  2010 Male      2137    1799.     671.  797.    763.    831. 95%       </span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co">#&gt; # ℹ 30 more rows</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: statistic &lt;chr&gt;, method &lt;chr&gt;</span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a><span class="co"># calculate the same indirectly standardised rates by appending the reference data to the data frame</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="co"># and drop metadata columns from output</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>df_std <span class="sc">%&gt;%</span></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">refobs =</span> <span class="fu">rep</span>(df_ref<span class="sc">$</span>obs,<span class="dv">40</span>),</span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a>           <span class="at">refpop =</span> <span class="fu">rep</span>(df_ref<span class="sc">$</span>pop,<span class="dv">40</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a>    <span class="fu">group_by</span>(area, year, sex) <span class="sc">%&gt;%</span></span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>    <span class="fu">calculate_ISRate</span>(obs, pop, refobs, refpop, <span class="at">refpoptype =</span> <span class="st">&quot;field&quot;</span>,</span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a>                     <span class="at">type =</span> <span class="st">&quot;standard&quot;</span>)</span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a><span class="co">#&gt; # A tibble: 40 × 9</span></span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a><span class="co">#&gt; # Groups:   area, year, sex [40]</span></span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a><span class="co">#&gt;    area   year sex    observed expected ref_rate value lowercl uppercl</span></span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt; &lt;int&gt; &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a><span class="co">#&gt;  1 Area1  2006 Female     1976    1921.     671.  690.    660.    721.</span></span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a><span class="co">#&gt;  2 Area1  2006 Male       2067    1971.     671.  703.    673.    734.</span></span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a><span class="co">#&gt;  3 Area1  2007 Female     2027    2100.     671.  647.    619.    676.</span></span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a><span class="co">#&gt;  4 Area1  2007 Male       2110    1984.     671.  713.    683.    744.</span></span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a><span class="co">#&gt;  5 Area1  2008 Female     1872    1957.     671.  641.    613.    671.</span></span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a><span class="co">#&gt;  6 Area1  2008 Male       2172    1958.     671.  744.    713.    776.</span></span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a><span class="co">#&gt;  7 Area1  2009 Female     1765    1848.     671.  640.    611.    671.</span></span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a><span class="co">#&gt;  8 Area1  2009 Male       1935    1869.     671.  694.    664.    726.</span></span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a><span class="co">#&gt;  9 Area1  2010 Female     2419    2013.     671.  806.    774.    839.</span></span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a><span class="co">#&gt; 10 Area1  2010 Male       2137    1799.     671.  797.    763.    831.</span></span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a><span class="co">#&gt; # ℹ 30 more rows</span></span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
